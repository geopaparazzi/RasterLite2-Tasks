---
-- export "SPATIALITE_SECURITY=relaxed"
-- sqlite3 2010.berlin_k5.db < RL2_WriteGeoTiff.Spandau_1928.sql
-- sqlite3 1926.berlin_k4.db < RL2_WriteGeoTiff.Spandau_1928.sql
-- sqlite3 1910.berlin_data.db < RL2_WriteGeoTiff.Spandau_1928.sql
-- sqlite3 1926.berlin_eiskeller.db < RL2_WriteGeoTiff.Eiskeller_1928.sql
---
SELECT load_extension('/usr/local/lib/mod_rasterlite2');
SELECT load_extension('/usr/local/lib/mod_spatialite');
---
-- gdalwarp -s_srs epsg:3068 -t_srs epsg:3068 -te 18028.0 20838.0 28338.0  19400.0 2010.Berlin.5000.3068.FAX4_MINISWHITE.tif 2010.Berlin.5000.3068.schnitt_Schmettau.tif
-- rl2tool EXPORT --db-path 2010.berlin_k5.db --coverage "2010.berlin_k5" --resolution 0.211665 --compression FAX4  --min-x 18028.0 --min-y 20838.0 --max-x 25528.0 --max-y 28338.0 --dst-path 2010.Berlin.5000.3068.schnitt_schmettau.tif
-- rl2tool EXPORT --db-path 2010.berlin_k5.db --coverage "2010.berlin_k5" --base-resolution --compression FAX4  --min-x 18028.0 --min-y 20838.0 --max-x 25528.0 --max-y 28338.0 --dst-path 2010.Berlin.5000.3068.schnitt_schmettau.tif
-- gaiaToEWKT (&out_buf, geo);
---
SELECT DateTime('now'),'command: RL2_WriteGeoTiff : berlin_k4.2010 : 1926.berlin_eiskeller_schnitt_spandau_1928.3068.tif';
-- SELECT tile_id, MbrMinX(geometry), MbrMaxY(geometry) FROM "1907.berlin_verkehrsplan_tiles" WHERE pyramid_level = 0 AND ROWID IN ( SELECT ROWID FROM SpatialIndex WHERE f_table_name = '1907.berlin_verkehrsplan_tiles' AND search_frame = BuildMBR(-4.2404,12723.0943,16707.8890,31304.5746))
-- 170
-- SELECT tile_id, MbrMinX(geometry), MbrMaxY(geometry), BuildMBR(-4.2404,12723.0943,16707.8890,31304.5746) AS search_geom  FROM "1907.berlin_verkehrsplan_tiles" WHERE pyramid_level = 0 AND ROWID IN ( SELECT ROWID FROM SpatialIndex WHERE f_table_name = '1907.berlin_verkehrsplan_tiles' AND search_frame = search_geom AND ST_Contains(search_geom,geometry));
-- 135
-- SELECT tile_id, MbrMinX(geometry), MbrMaxY(geometry), BuildMBR(-4.2404,12723.0943,16707.8890,31304.5746) AS search_geom  FROM "1907.berlin_verkehrsplan_tiles" WHERE pyramid_level = 0 AND ROWID IN ( SELECT ROWID FROM SpatialIndex WHERE f_table_name = '1907.berlin_verkehrsplan_tiles' AND search_frame = search_geom AND ST_Intersects(geometry,search_geom));
-- SELECT tile_id, MbrMinX(geometry), MbrMaxY(geometry), BuildMBR(-4.2404,12723.0943,16707.8890,31304.5746) AS search_geom  FROM "1907.berlin_verkehrsplan_tiles" WHERE pyramid_level = 0 AND ROWID IN ( SELECT ROWID FROM SpatialIndex WHERE f_table_name = '1907.berlin_verkehrsplan_tiles' AND search_frame = search_geom AND ST_Touches(geometry,search_geom));

SELECT RL2_WriteGeoTiff
(
 -- '2010.berlin_k5', -- raster_coverage
 -- '1926.berlin_k4', -- raster_coverage [rl2_get_raw_raster_data: Insufficient Memory !!!]
 -- '1907.berlin_verkehrsplan', -- raster_coverage
 '1926.berlin_eiskeller', 
 '../berlin_images/1926.berlin_eiskeller_schnitt_spandau_1928.3068.tif', 
 0,0, -- image-size based on extent of polygon and base-resolution
 GeomFromEWKT
 (
  'SRID=3068;MULTIPOLYGON(((8800 30104.50102701794,8800 27100,7850.617975478497 27100,7850.626333223513 27101.40410116262,7912.809344001922 27138.67528464162,7926.906734644234 27152.77267528391,7949.114952779376 27215.14880100265,7961.088079078325 27284.09083469176,7962.246768720157 27328.12104108143,7954.908400988547 27379.2965002624,7983.103182273165 27426.03031581636,8008.015009572587 27463.30149929535,8007.242549811366 27517.95302740185,8003.573365945559 27607.36524476333,8018.829446229701 27634.78756628674,8006.276975109835 27701.02599081155,8019.022561170007 27744.28373744001,8012.649768139923 27805.6942884572,8004.042762114328 27858.31035690091,8014.194687662366 27929.8671950737,8009.366814154725 27981.23576919499,7988.896630482328 28024.68663076376,7986.479169733253 28096.6733963584,7973.933746603909 28122.51696800484,7933.035667202251 28227.14579690358,7903.93028554218 28278.58203173388,7864.03583999087 28396.25810068711,7865.290382303805 28439.41435625205,7859.017670739133 28462.24702634744,7816.865049024541 28503.14510574911,7767.686990357521 28536.26502281057,7749.621581051264 28591.21397611709,7746.607170439268 28657.04053737195,7762.850863572706 28711.933017616,7736.804941824257 28763.18467008875,7712.719465798813 28873.24969425152,7619.178198444183 28864.00759298594,7437.416873554489 28845.80345412952,7350.161228834776 28908.27572221501,7378.437872809508 28964.43074757327,7369.277833212062 29023.37361106992,7367.684782847289 29028.94928734661,7327.061998545556 29038.10932694407,7293.60794088531 29041.6936902648,7254.578206948352 29033.33017584975,7153.817771376417 29010.23094556052,7104.002971104197 28989.32761431593,7071.332836173433 28968.59783326847,7021.57142182766 28932.48930121634,6973.609117059737 28925.08151068937,6910.203452379621 28887.9170022828,6862.617814926627 28879.37920981103,6846.295564612933 28869.58585962282,6819.426629481164 28843.47025912089,6801.723265679385 28811.70464889501,6791.897185140445 28760.24931817239,6823.403635376135 28706.88704209752,6844.124093639245 28684.17969057631,6878.468962815089 28643.02261594411,6931.263555101922 28614.63842654258,7139.035821521078 28606.26509066913,7158.053228420097 28619.32181779382,7177.35447721313 28636.06848954072,7194.526911801053 28675.09674996784,7194.526911801053 28736.83236191613,7256.404444696378 28728.17518414868,7278.57785321364 28722.412024991,7365.172819299808 28688.45533707301,7486.032536954699 28695.3914453899,7483.052197067539 28686.73426762246,7366.960862415307 28680.48974595412,7307.070222778093 28660.62081337305,7410.644248096434 28445.68706781672,7356.698928640262 28394.25083298642,7298.48816532011 28389.73448065984,7236.262866598573 28370.66543750324,7099.015937563565 28310.94922340759,7070.161464366081 28286.36019407408,7038.797906542724 28265.03297475419,6925.638189916055 28281.34202482233,6874.703772010921 28254.24391086295,6825.274804881312 28233.92032539342,6788.642169343635 28224.6367122777,6781.86764085379 28229.65488152944,6597.449920852454 28180.47682286243,6583.900863872767 28180.727731325,6555.297299137862 28202.80767603265,6532.715537505046 28246.21484006019,6505.617423545671 28328.26190732606,6491.315641178219 28410.0580661294,6452.926646402432 28534.50866357248,6437.370321722046 28563.86495369513,6414.035834701468 28584.18853916466,6387.439537667262 28590.96306765449,6305.894287326536 28575.15583451154,6280.803441067852 28572.89765834825,6377.806620613439 28886.53914031033,6315.459292035305 28894.59418791025,6315.786015681993 28895.91273485383,6310.102180234524 28896.62765361403,6282.363580023442 28903.982793332,6214.404727811811 28917.38018545521,6080.940383535265 29008.12607951804,6082.728266885928 29013.45082646623,6215.843851243864 28921.59549552981,6273.646603732183 28910.46923762551,6316.716926885347 28899.58689839562,6351.253164511625 29039.01295224408,6509.351142633026 28994.12570394716,6603.029457496641 28995.31150540112,6676.845598006259 29013.69142793766,6794.1433118565 29041.89197602877,6833.991098991838 28871.72030774076,6840.51999911732 28876.36587129157,6873.541167059634 28888.67033691265,6917.360131363318 28897.96146401431,6932.929047047152 28905.11814299799,6970.846890083574 28932.48930121634,7019.31141793807 28938.13931094032,7056.601482116278 28966.51491533183,7094.01710206613 28995.89496589647,7136.454952881726 29014.9794431863,7094.247709803616 29236.91855164747,7194.670270436678 29254.92791122963,7242.547004140707 29266.19302504236,7335.928868640829 29297.17208802733,7410.296699288785 29344.93250152148,7719.682822720475 29526.89542087628,7734.436042841257 29539.84672098232,7933.175777933603 29789.47397074869,8047.513980233426 29963.28859040543,8155.204039891426 29947.47775848248,8142.773478072012 29793.449290682,8291.773898663523 29783.21443751038,8305.222019691353 29925.19327278648,8303.19885104115 29925.78832238947,8307.007168500358 29966.01367555234,8294.511126837331 29967.08476483777,8272.851321288088 30064.07785012697,8263.124873446175 30174.72507449629,8755.407060331517 30296.6601833001,8760.588285974572 30297.71004930491,8785.035979961026 30167.36972729573,8785.188327990334 30108.46692776828,8800 30104.50102701794),(6819.704279600425 28705.73638580874,6759.124607439549 28266.24031073107,6784.365375452921 28237.62551067737,6842.181584261436 28675.09984661186,6819.704279600425 28705.73638580874),(6779.810455011018 28233.84418533687,6758.057458051554 28258.49830832636,6753.909677499638 28225.87682661008,6779.810455011018 28233.84418533687),(6829.216989509443 28867.78847625109,6680.231952716922 28911.83289586842,6572.993365822567 28876.59736017456,6601.717987312124 28809.5732433656,6713.169518691617 28827.95700111892,6711.637538878841 28834.08492037,6744.515737015804 28828.53837152988,6752.249483877844 28830.74801349046,6797.073649363959 28823.17209819706,6810.804995833301 28848.58298074375,6829.216989509443 28867.78847625109),(7279.640249492123 28719.21370267219,7305.671375922051 28665.20373825696,7363.491367876548 28686.39796998984,7316.990073632458 28703.40572806268,7279.640249492123 28719.21370267219)),((7168.962634664637 27755.29695085268,7221.273396841407 27647.51603787225,7270.470620044228 27578.50785230588,7321.648939483406 27532.61245616363,7343.771180789372 27455.34970294579,7414.430279886038 27368.51165125222,7468.910426385809 27379.40768055216,7545.182631485483 27333.51228440993,7609.487777132419 27287.21189854231,7650.83077921486 27253.99448649178,7620.904400090395 27195.53324705607,7557.799931241472 27219.19742287441,7522.23681955966 27244.33225368712,7488.946538323682 27249.01161048734,7459.009016866906 27210.08979979411,7457.189337203841 27184.97822044376,7441.585584093028 27177.15359789256,7427.551304691609 27206.29121849744,7422.053467630131 27229.07373014833,7409.498945134178 27255.27983827672,7384.951466479385 27246.07453378117,7368.801809469649 27266.74609475363,7336.098754024938 27357.50716714833,7277.152505939406 27420.9753191966,7240.331287957211 27470.23177307629,7206.578504806861 27505.5995219276,7170.564769675154 27532.56944913386,7100.313761682808 27570.52114310675,7088.5245120657 27589.73923494834,7062.05349887872 27619.74036290451,7034.134054746828 27661.04317615479,7168.962634664637 27755.29695085268)),((8181.418527221841 30494.64093694902,8747.715581733989 30643.22871276575,8791.281983194085 30575.30649058831,8757.976009219479 30493.17911701837,8758.440015295615 30451.18061650493,8760.157215481542 30377.34100851005,8413.161589253222 30286.21632529771,8406.114251628179 30356.68970154815,8193.489165120434 30301.13730609355,8181.418527221841 30494.64093694902)))'
 ),
 0,0, -- use base-resolution
 0, -- no world-file
 'JPEG'
);
---
SELECT DateTime('now'),'RL2_WriteGeoTiff.sql [finished] [Habe fertig!]';



